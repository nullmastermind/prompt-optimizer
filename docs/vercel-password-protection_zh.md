# Vercel 部署密码保护

本文档说明如何为您的 Vercel 部署启用和使用密码保护功能。此功能使用 Next.js Middleware 和 Vercel API 函数，通过美观的身份验证页面来限制对您已部署应用程序的访问。

## 工作原理

启用密码保护后，尝试访问您的 Vercel 部署的用户将被中间件拦截：
- 如果他们未经身份验证，将看到一个美观的密码验证页面。
- 如果他们输入正确的密码，他们将被授予访问应用程序的权限。一个 Cookie 会被设置在他们的浏览器中以记住他们的会话，因此他们在一段时间内（例如 7 天）或直到他们清除 Cookie 之前无需重新输入密码。
- 如果他们输入错误的密码，他们将看到错误消息并被提示重试。
- 验证页面会根据用户浏览器语言设置自动选择显示中文或英文界面。

此保护完全通过 Next.js Middleware 和 Vercel API 实现，无需修改主要的 web 应用程序代码。

## 设置说明

1. **设置访问密码环境变量：**
   * 进入您在 Vercel 中的项目设置。
   * 导航到"Settings"->"Environment Variables"。
   * 创建一个名为 `ACCESS_PASSWORD` 的新环境变量。
   * 将其值设置为您希望用于访问站点的密码。选择一个强壮且唯一的密码。
   * 确保该变量在您希望保护的所有环境（生产、预览、开发）中都可用。
   * 当您添加或更改环境变量时，Vercel 会提示您重新部署项目。请按照提示完成重新部署。

2. **访问受保护的站点：**
   * 一旦设置了 `ACCESS_PASSWORD` 并且项目已重新部署，请尝试访问您的 Vercel 部署 URL。
   * 您应该会看到一个密码验证页面。
   * 输入您在 `ACCESS_PASSWORD` 环境变量中配置的密码。
   * 成功验证后，页面将重新加载并显示主应用程序。

## 技术细节

- **所用技术：** 
  - Next.js Middleware（`middleware.js`）用于拦截所有页面请求并提供验证页面
  - Vercel API 函数（`/api/auth.js`）用于服务端密码验证
  - 自适应语言的验证页面（根据浏览器语言自动显示中文或英文）
- **Cookie 名称：** `vercel_access_token`（此 Cookie 存储访问密码。它是 HttpOnly，在生产环境中是 Secure，并且 SameSite=Strict）。
- **密码存储：** 实际密码仅作为环境变量存储在您的 Vercel 项目设置中。它没有硬编码在应用程序中。
- **绕过保护：** 如果未设置 `ACCESS_PASSWORD` 环境变量或该变量为空，则密码保护将被绕过，站点将公开访问。这允许在需要时轻松禁用该功能。
- **非侵入性实现：** 此保护完全独立于主要的 web 应用程序代码。所有逻辑都包含在 `middleware.js` 和 `api/auth.js` 文件中。
- **安全说明：** 这是表现层保护，可以被禁用 JavaScript 或直接访问 API 端点的用户绕过。如需更强的安全性，请考虑使用 Vercel 的内置密码保护功能。
- **多语言支持：** 验证页面会自动检测浏览器的 `accept-language` 请求头，为中文用户显示中文界面，为其他语言用户显示英文界面。

## 故障排除

- **密码验证页面未出现：**
  * 确保在 Vercel 中正确设置了 `ACCESS_PASSWORD` 环境变量，并且项目已完成重新部署。
  * 检查浏览器控制台中是否有与中间件或身份验证 API 相关的任何错误。
  * 通过直接访问 `/api/auth` 端点来验证它是否正常工作。
- **即使使用正确的密码也提示密码错误：**
  * 仔细检查 `ACCESS_PASSWORD` 环境变量的值是否有拼写错误或多余的空格。
  * 尝试清除站点的浏览器 Cookie，然后重试。
  * 检查浏览器网络选项卡以查看 API 调用是否成功。
- **语言显示问题：**
  * 如果验证页面语言与您的浏览器设置不符，请确认您的浏览器已正确设置首选语言。
  * 您可以通过修改浏览器的语言设置来切换验证页面的显示语言。

如需进一步帮助，请查看项目的主 README 文件或在存储库中提交问题。
