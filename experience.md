# 经验文档

## API 集成最佳实践

### 架构设计
- 配置与业务逻辑分离，便于扩展支持更多模型
- API 配置统一接口格式 (endpoint、认证、请求/响应格式)
- 提示词模板单独管理，支持多语言
- 统一的错误处理机制

### 认证处理
- URL 参数认证 (如 Gemini)
- Header 认证 (如 DeepSeek Bearer Token)
- 封装统一的认证处理机制

### 数据处理
- 注意不同模型的请求格式差异
- 确保数据结构完整性
- 使用类型定义约束数据结构
- 响应格式统一解析
- 参数标准化 (temperature、max_tokens 等)

## 代码重构原则

### 模块化设计
- 明确模块职责边界
- 避免功能重复实现
- 合理拆分功能模块
- 保持接口一致性

### 依赖管理
- 统一的导入导出路径
- 检查所有引用点
- 确保函数单一定义
- 注意初始化顺序

### 错误处理
- UI 层负责错误展示
- 服务层继续传递错误
- 添加合适的日志
- 使用 loading 状态防止重复提交

## 项目结构规范

### 目录组织（src）
- api/: 外部 API 封装
- services/: 业务逻辑
- config/: 配置文件
- components/: UI 组件
- prompts/: 提示词模板

### 代码迁移
- 确认新实现完整性
- 检查所有依赖引用
- 完整更新所有调用点
- 保留迁移记录

## 开发环境说明

### 环境
- 当前使用windows系统，执行命令注意是windows命令，而非linux命令


### Vue 组件开发
- 事件处理函数命名匹配
- 异步操作统一处理
- 模板字符串正确使用
- 状态管理规范化
- 下拉框样式优化：
  - 使用 min-w-[width] 确保足够宽度
  - 自定义下拉箭头使用内联 SVG 作为背景图片
  - 使用 appearance-none 移除默认样式
  - 合理设置内边距确保文本显示完整

## LLM API 统一化经验

### 统一接口设计
- 使用 OpenAI 格式作为标准接口
- 将不同模型的差异封装在配置层
- 支持动态添加新模型
- 环境变量自动初始化模型状态

### 模型配置管理
- 统一的模型配置结构
  - baseUrl: API 端点
  - models: 支持的模型列表
  - defaultModel: 默认模型
  - authType: 认证类型 (bearer/query)
  - enabled: 启用状态
- 支持自定义模型配置
- API 密钥安全存储
- 动态模型启用/禁用

### 请求处理标准化
- 统一的消息格式
  - system: 系统提示词
  - user: 用户输入
- 统一的请求参数
  - temperature
  - max_tokens
- 统一的响应解析
- 错误处理标准化

### 用户界面优化
- 动态模型选择列表
- 模型配置管理界面
- 启用状态可视化
- 配置保存反馈

# 环境配置最佳实践

- `.env.local` 文件用于存储本地环境变量和敏感信息
- 应该创建 `.env.example` 作为模板文件并提交到仓库
- 环境文件应该在 `.gitignore` 中明确列出
- 常见的环境文件模式：
  - .env.local
  - .env.*.local
  - .env.development.local
  - .env.test.local
  - .env.production.local

## 三栏布局最佳实践

### 布局设计
- 使用 CSS Grid 实现响应式布局
- 移动端自动切换为单列布局
- 合理设置列间距和内边距
- 使用 min-height 确保内容区域高度

### 组件拆分
- 按功能模块拆分组件
- 保持组件职责单一
- 使用 props/emit 进行组件通信
- 统一的样式和交互模式

### 状态管理
- 将共享状态提升到父组件
- 使用 v-model 实现双向绑定
- 异步操作状态独立管理
- 错误状态统一处理

### 交互优化
- 添加合适的加载状态
- 实现一键复制功能
- 优化表单验证反馈
- 添加必要的提示信息

## 界面优化经验

### 提示词优化器优化要点
1. 模型选择
   - 优化和测试可以使用不同的模型
   - 下拉框宽度应根据模型名称动态调整
   - 默认选择第一个可用模型

2. 提示词展示
   - 使用可调整大小的文本区域
   - 设置合理的最小和最大高度
   - 添加拖动手柄样式提示
   - 保持滚动条功能但隐藏其显示

3. 交互逻辑
   - 优化后的提示词自动用于测试
   - 如果没有优化结果，使用原始提示词
   - 移除多余的确认按钮
   - 保持界面简洁直观

### 常见问题修复
1. API 方法命名
   - chat -> sendMessage：更准确地描述功能
   - 保持方法命名的一致性和语义化
   - 在修改方法名时同步更新所有调用点

2. 组件样式
   - 使用 resize-y 实现可调整大小
   - 使用 min-height 和 max-height 控制尺寸范围
   - 使用 overflow-auto 处理内容溢出
   - 保持滚动的可用性同时隐藏滚动条

3. 状态管理
   - 提示词状态和测试状态分开管理
   - 使用 watch 监听属性变化
   - 合理设置默认值
   - 及时清理和重置状态

## Vue 组件开发最佳实践

### Props 和 v-model 使用
1. Props 是只读的
   - 不能直接使用 v-model 绑定 props
   - 应该使用 :value 绑定
   - 需要修改时使用 emit 发送事件

2. 双向绑定的正确实现
   - 父组件使用 v-model
   - 子组件使用 :value 和 @input
   - 或者使用计算属性的 get/set
   - 明确声明 emit 事件

3. 常见错误修复
   ```vue
   <!-- 错误用法 -->
   <textarea v-model="propValue"></textarea>
   
   <!-- 正确用法 -->
   <textarea 
     :value="propValue"
     @input="$emit('update:propValue', $event.target.value)"
   ></textarea>
   ```

4. 只读场景优化
   - 使用 :value 单向绑定
   - 添加 readonly 属性
   - 不需要 emit 事件
   - 保持代码简洁
